<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.stock.db.bean.StockExchangeInfo">
	<select id="selectByCode" parameterType="org.stock.db.bean.StockBaseInfo" resultType="org.stock.db.bean.StockExchangeInfo">
		select id, code, type, open, hight, low, close, adj_close as adjClose, volume, record_time as recordTime from stock_exchange_info where code=#{code} and type=#{type}
	</select>
	
	<select id="selectByCodeFomMaxDate" parameterType="org.stock.db.bean.StockBaseInfo" resultType="org.stock.db.bean.StockExchangeInfo">
		select id, code, type, open, hight, low, close, adj_close as adjClose, volume, record_time as recordTime from stock_exchange_info where code=#{code} and type=#{type} order by record_time desc limit 1
	</select>	
	
	<select id="selectMaxDate" resultType="org.stock.db.bean.StockExchangeInfo">
		select code, type, max(record_time) as recordTime from stock_exchange_info group by code, type
	</select>	
	
	<insert id="insert" parameterType="org.stock.db.bean.StockExchangeInfo"
		flushCache="true" keyProperty="id" useGeneratedKeys="true">
		insert into stock_exchange_info(code, type, open, hight, low, close, adj_close, volume, record_time) 
		values(#{code}, #{type}, #{open}, #{hight}, #{low}, #{close}, #{adjClose}, #{volume}, #{recordTime})
	</insert>
	
	<insert id="insertBatch" parameterType="java.util.List"
		flushCache="true">
		insert into stock_exchange_info(code, type, open, hight, low, close, adj_close, volume, record_time) 
		values
		<foreach collection="list" item="item" index="index"  
        separator=",">  
			(#{item.code}, #{item.type}, #{item.open}, #{item.hight}, #{item.low}, #{item.close}, #{item.adjClose}, #{item.volume}, #{item.recordTime})
    	</foreach> 
	</insert>
</mapper>